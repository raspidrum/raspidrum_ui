## Текущая реализация (30.05.2025)

### Получение пресета 
Реализовано в слое data/repositiries.
Включает выполнение запроса к серверу по gRPC и преобразование модели gRPC в доменную модель (model/channel_control.dart).

**Проблемы:**
- ориентирован только на gRPC
  - не предусмотрена работа в локальном режиме (с заглушкой без обращения к серверу)
  - маппинг gRPC <-> доменная модель выполняется в репозитории, а не в service, что не позволяет использовать локальный режим для тестов



### Установка значения контрола
Реализовано в слое services/channel_control
Включает формирование модели gRPC (services/proto/channel_control.pb.dart).
Полученный результат преобразует в доменную модель (services/channel_control/model/channel_control.dart).
Использует провайдер для получения клиента (services/remote_provider.dart).

**Проблемы:**
- доменная модель (ответ об установленном значении) описана на уровне сервиса


## Как должно быть

1. Установка значений контрола и выдача пресета должна реализовываться в доменном слое
  Т.к. установка значения должна изменять значение в исходной модели, полученной от сервера.
  Это обеспечит консистентность при запросе пресета или отдельных каналов/инструментов/слоев в различных разделах приложения.
  Это обеспечит сохранение пресета на БД сервера с актуальными измененными значениями контролов (это пункт не принципиален, т.к. сервер вынужден хранить состояние пресета и изменять его при получении событий изменений контрола. Сервер будет хранить состояние, т.к. серверу требуется маппинг ключа контрола на реальный контрол в семплере)

2. Запрос различными разделами приложения пресета или объектов пресета (канал/инструмент/слой) не должен приводить к перезапросу к серверу (или локальной заглушке)
   1. Следовательно, для перезапроса с сервера нужен отдельный метод, либо выполнять реальный запрос, если в домене нет пресета или его id отличается

3. Решение должно быть расшираемым под логику:
   1. Сохранение пресета (сохранение параметров всех контролов в БД сервера)
   2. Конструирование нового пресета
      1. создание/удаление/изменение(название, описание) пресета 
      2. добавление/удаление/изменение каналов
      3. добавление/удаление/изменение инструментов
      4. добавление/удаление/изменение слоев
      5. добавление/удаление/изменение контролов (базовых, tunes, fx)
      6. сохранение сконструированного пресета в БД сервера

4. В получении пресета нужно поддержать локальный режим

5. Доменные модели не должны быть размазаны по слоям

### Реализация

- [x] 1. Перенести модель из services/channel_control в model
- [x] 2. Заменить lib/src/services/channel_control/model/channel_control.dart на lib/src/model/control_value.dart
- [x] 3. Удалить model/channel_control.dart, если нигде не используется

- [x] 4. Создать remote и local сервис в папке service/kit_preset (нужно создать папку). Они должны реализовывать один интерфейс. Добавить получение этих сервисов в providers.dart по аналогии с ChannelControlRemote и ChannelControlLocal. 
- [x] 5. В data/repositories/kit_preset_repository.dart добавить интерфейс сервиса kit_preset. Инжектить в этот интерфейс remote или local сервис при создании kit_preset_repository
- [x] 6. Перенести логику запроса к gRPC из data/repositories/kit_preset_repository.dart в созданный в п.3 remote сервис
- [x] 7. В kit_preset_repository.dart хранить полученный preset. При получении вызова getPreset если данных нет, то выполнять запрос на сервер, иначе возвращать сохраненные данные

- [x] 8. ControlsRepository (data/repositories/controls_repository.dart) переименовать в ControlHandler, заинжектить его в kit_preset_repository.dart
- [x] 9. Добавить метод setValue в kit_preset_repository.dart. Но вместо key передавать ссылку на объект Control в Preset. Этот метод должен изменять значение в Control и вызывать setValue в ControlHandler.
   
